<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>文章列表</title>
  <link rel="stylesheet" href="js/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/iconfont.css">
  <link rel="stylesheet" href="css/main.css">
  <script src="js/jquery-1.12.4.min.js"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="common_title">
      文章列表
    </div>
    <div class="container-fluid common_con">
      <div class="row opt_btns">
        <div class="col-xs-6">
          <form class="form-inline">
            <select id="selCategory" name="" class="form-control input-sm">
                            <option>所有分类</option>
                            <!-- <option>未分类</option>
                            <option>奇趣事</option>
                            <option>会生活</option>
                            <option>爱旅行</option> -->
                        </select>
            <select id="selStatus" name="" class="form-control input-sm">
                            <option>所有状态</option>
                            <option value="草稿">草稿</option>
                            <option value="已发布">已发布</option>
                        </select>
            <button id="btnSearch" class="btn btn-default btn-sm">筛选</button>
          </form>
        </div>
        <div class="col-xs-6">
          <a href="article_release.html" class="btn btn-success btn-sm pull-right" id="release_btn">发表文章</a>
        </div>
      </div>

      <table class="table table-striped table-bordered table-hover mp20">
        <thead>
          <tr>
            <th>标题</th>
            <th>作者</th>
            <th>分类</th>
            <th class="text-center">发表时间</th>
            <th class="text-center">状态</th>
            <th class="text-center" width="100">操作</th>
          </tr>
        </thead>
        <tbody>



          <!-- <tr>
                        
                        <td>王积千造统最头</td>
                        <td>杰克</td>
                        <td>奇趣事</td>
                        <td class="text-center">2017-06-08 07:08:46</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1005 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                     
                        <td>级电使正回</td>
                        <td>肉丝</td>
                        <td>爱旅行</td>
                        <td class="text-center">2017-06-06 10:45:24</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1004 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                       
                        <td>近难领管年算</td>
                        <td>杰克</td>
                        <td>会生活</td>
                        <td class="text-center">2017-05-27 16:49:04</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1003 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                       
                        <td>龙大实究</td>
                        <td>杰克</td>
                        <td>未分类</td>
                        <td class="text-center">2017-04-13 10:43:41</td>


                        <td class="text-center">草稿</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=1002" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1002 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                      
                        <td>算性得走来拉</td>
                        <td>肉丝</td>
                        <td>奇趣事</td>
                        <td class="text-center">2017-04-06 04:58:12</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=1001" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1001 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                      
                        <td>几平会出气</td>
                        <td>管理员</td>
                        <td>奇趣事</td>
                        <td class="text-center">2017-04-03 20:16:34</td>


                        <td class="text-center">草稿</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=1000" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 1000 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                      
                        <td>世团先证型角</td>
                        <td>杰克</td>
                        <td>奇趣事</td>
                        <td class="text-center">2017-04-03 14:40:08</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=999" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 999 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                      
                        <td>构更反步五</td>
                        <td>肉丝</td>
                        <td>奇趣事</td>
                        <td class="text-center">2017-03-30 22:31:52</td>


                        <td class="text-center">已发布</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=998" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 998 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                       
                        <td>组方些</td>
                        <td>肉丝</td>
                        <td>会生活</td>
                        <td class="text-center">2017-02-08 05:38:43</td>


                        <td class="text-center">草稿</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=996" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 996 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr>



                    <tr>
                      
                        <td>日做发光成</td>
                        <td>管理员</td>
                        <td>爱旅行</td>
                        <td class="text-center">2017-01-26 22:19:59</td>


                        <td class="text-center">草稿</td>


                        <td class="text-center">
                            <a href="post-edit.html?id=995" class="btn btn-default btn-xs">编辑</a>
                            <a href="javascript:deleteTr( 995 );" class="btn btn-danger btn-xs">删除</a>
                        </td>
                    </tr> -->


        </tbody>
      </table>

      <div class="row text-center">
        <ul class="pagination pagination-sm">
          <li class="page-item first disabled"><a href="#" class="page-link">首页</a></li>
          <li class="page-item prev disabled"><a href="#" class="page-link">上一页</a></li>
          <li class="page-item active"><a href="#" class="page-link">1</a></li>
          <li class="page-item"><a href="#" class="page-link">2</a></li>
          <li class="page-item"><a href="#" class="page-link">3</a></li>
          <li class="page-item"><a href="#" class="page-link">4</a></li>
          <li class="page-item"><a href="#" class="page-link">5</a></li>
          <li class="page-item"><a href="#" class="page-link">6</a></li>
          <li class="page-item"><a href="#" class="page-link">7</a></li>
          <li class="page-item next"><a href="#" class="page-link">下一页</a></li>
          <li class="page-item last"><a href="#" class="page-link">尾页</a></li>
        </ul>
      </div>

    </div>
  </div>

  <script>
    // 设置左侧菜单
    $('#release_btn').click(function() {
      window.parent.setMenu(1, 1);
    })
  </script>
  <!-- 引入jQuery分页插件的文件 -->
  <script src="./js/jquery.twbsPagination.js"></script>
  <!-- 引入base接口数据文件 -->
  <script src="./tool/base.js"></script>
  <!-- 引入ajax处理文件 -->
  <script src="./tool/wenzhang.js"></script>
  <!-- 引入插件js 模板引擎文件 -->
  <script src="./js/template-web.js"></script>
  <!-- 利用模板引擎设置页面文件渲染 -->
  <script type="text/html" id="article">
    <!-- each是遍历数据  -->
    {{ each data v}}
    <tr>
      <td>{{v.title}}</td>
      <td>{{v.author}}</td>
      <td>{{v.type}}</td>
      <td class="text-center">{{v.data}}</td>
      <td class="text-center">{{v.state}}</td>
      <td class="text-center"><a href="post-edit.html?id=995" class="btn btn-default btn-xs">编辑</a>
        <a href="javascript:deleteTr( 995 );" class="btn btn-danger btn-xs">删除</a>
      </td>
    </tr>
    <!-- 再用闭合标签给闭合一下 -->
    {{/each}}
  </script>
  <!-- 利用模板引擎给下拉框渲染数据 -->
  <script type="text/html" id="category">
    {{ each data v }}
    <option value="{{v.id}}">{{ v.name }}</option>
    {{ /each }}
  </script>
  <!-- 进行文件数据请求 -->
  <script>
    // 设置一个总页数，利用jquery中的分页功能进行分页的设置
    // 设置一个当前的页码，当前的页码为一；
    var myPage = 1;
    var myTotalPage;
    //   使用ajax请求后台数据
    // 1： 功能一，实现页面的基本渲染
    // 把他们都设置在一个函数内方便调用使用，减少冗余代码；
    getArice();

    function getArice() {
      $.ajax({
        url: USER_SEARCH,
        data: {
          page: myPage
        },
        success: function(res) {
          if (res.code === 200) {
            // 通过和模板引擎进行相配合来实现渲染页面
            var htmlSrc = template('article', res);
            $('tbody').html(htmlSrc);
            // 在我们获取数据的时候还有一条关于页码的数据，我们给他用个变量保存起来
            //  我们在一开始获取数据的时候就应该把这个页码数给保存起来
            var totPage = res.totalPage;
            // totPage这个变量是我们获取到数据所有的页码数
            // console.log(totPage)；
            // 设置一个关键性判断，如果页面数相同则不用再刷新页面显示，这期间有点毛病所以只能这么写；
            if (totPage === myTotalPage) {
              // - 如果上一次和当前的总页数一致，同时上一次又点击了除1以外的其他页码
              //   - 会导致页码无法更新为1，所以就不进行改进了
              return;
            }
            //  - 如果页数不同，将当前的最新页号设置给全局变量myTotalPage保存
            myTotalPage = totPage;
            // twbsPagination这个方法是jQuery分页插件对象
            // twbsPagination('destroy')覆盖之前的数据，更新新的数据，先删除旧的，再设置新的
            $('.pagination').twbsPagination('destroy');
            $('.pagination').twbsPagination({
              // 分页部分的总页数

              totalPages: totPage,
              // visiblePages固定写法，就是每次可显示多少个页面
              visiblePages: 5,
              // 首页尾页下一页和上一页
              // first: '首页',
              // last: '尾页',
              // prev: '上一页',
              // next: '下一页',
              first: '首页',
              last: '尾页',
              prev: '上一页',
              next: '下一页',
              // 获取到需要分页的标签元素，给他们设置点击事件，固定写法
              onPageClick: function(event, page) {
                // page代表当前点击的页码，就是以上设置的页码，数值类型
                // 把页面数当做参数传递，传递给服务器然后再次调用改函数获取相应的数据
                myPage = page;
                // 再次调用该函数
                getArice();
              }
            })
          }
        }
      });
    }

    // 1.1 ： 从后台拿到数据渲染给下拉框
    wenzhang.getCate({
        callback: function(res) {
          //   console.log(res);
          if (res.code === 200) {
            //   用模板引擎进行数据渲染
            var htmlSrc = template('category', res);
            // 因为他是个下拉框所以不能够直接改html这样的话会覆盖掉之前的数据
            // 所以要用append来插入从后台获取到的数据
            $('#selCategory').append(htmlSrc);
          }
        }
      })
      // 2： 功能二给筛选按钮设置点击事件；
    $('#btnSearch').on('click', function(e) {
      //   console.log(1)
      // 因为是个button按钮他的默认type是submit'所有我们要阻止他的默认事件，让他不能进行表单提交
      e.preventDefault();
      //   点击按钮之后进行ajax请求 ，根据下拉框里面的内容进行筛选数据
      $.ajax({
        url: USER_SEARCH,
        data: {
          // 这两个参数是下拉框所选中的内容
          type: $('#selCategory').val(),
          state: $('#selStatus').val()
        },
        success: function(res) {
          if (res.code === 200) {
            // 通过和模板引擎进行相配合来实现渲染页面
            var htmlSrc = template('article', res);
            $('tbody').html(htmlSrc);
          }
        }
      })
    });
  </script>
</body>

</html>